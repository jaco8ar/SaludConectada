{# templates/appointment_video_call.html #}
{% extends "base.html" %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'styles/scheduling/appointment_video_call.css' %}">
{% endblock %}

{% block content %}
<div class="video-call-container">
  <div class="video-call-header">
    <h1 class="video-call-title">Videollamada de la cita</h1>
    <div class="appointment-details">
      <div class="detail-item">
        <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <div class="detail-content">
          <span class="detail-label">Médico</span>
          <span class="detail-value">{{ appointment.doctor }}</span>
        </div>
      </div>
      <div class="detail-item">
        <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <div class="detail-content">
          <span class="detail-label">Paciente</span>
          <span class="detail-value">{{ appointment.patient }}</span>
        </div>
      </div>
      <div class="detail-item">
        <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <div class="detail-content">
          <span class="detail-label">Fecha y hora</span>
          <span class="detail-value">{{ appointment.scheduled_datetime }}</span>
        </div>
      </div>
    </div>
  </div>

  {% if appointment.video_call_url %}
    <div class="video-call-content">
      <div class="video-call-info">
        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        <p>
          Si tienes problemas con la vista incrustada, puedes 
          <a href="{{ appointment.video_call_url }}" target="_blank" class="external-link">
            abrir la videollamada en una nueva pestaña
            <svg class="external-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
          </a>
        </p>
      </div>

      <div class="video-frame-wrapper">
        <iframe
          src="{{ appointment.video_call_url }}"
          class="video-frame"
          allow="camera; microphone; fullscreen; display-capture"
          allowfullscreen
        ></iframe>
      </div>
    </div>
  {% else %}
    <div class="video-call-error">
      <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
      <h2 class="error-title">Error al cargar la videollamada</h2>
      <p class="error-message">
        No se ha podido generar la sala de videollamada para esta cita.
        Intenta recargar la página o contacta con soporte.
      </p>
      <button onclick="location.reload()" class="reload-button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
        Recargar página
      </button>
    </div>
  {% endif %}
</div>
{% endblock %}
