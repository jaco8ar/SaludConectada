{% extends "base.html" %}
{% load static %}
{% block extra_css %}
  <link rel="stylesheet" href="{% static 'styles/scheduling/doctor_appointments.css' %}">
{% endblock %}

{% block content %}
<div class="appointments-container">
  <div class="appointments-header">
    <h2>Citas como médico</h2>
  </div>

  {% if appointments %}
    <div class="appointments-table-wrapper">
      <table class="appointments-table">
        <thead>
          <tr>
            <th>Paciente</th>
            <th>Fecha y hora</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for appt in appointments %}
            <tr class="appointment-row {% if appt.status == 'CANCELED' %}canceled{% endif %}">
              <td class="patient-cell">
                <div class="patient-info">
                  <div class="patient-avatar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                      <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                  </div>
                  <span class="patient-name">{{ appt.patient }}</span>
                </div>
              </td>
              <td class="datetime-cell">
                <div class="datetime-info">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <span>{{ appt.scheduled_datetime|date:"d/m/Y H:i" }}</span>
                </div>
              </td>
              <td class="status-cell">
                <span class="status-badge status-{{ appt.status|lower }}">
                  {{ appt.get_status_display }}
                </span>
              </td>
              <td class="actions-cell">
                {% if appt.status != "CANCELED" %}
                  <div class="action-buttons">
                    <a href="{% url 'clinical:video_call' appt.pk %}" class="action-btn video-btn" title="Videollamada">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                      </svg>
                      <span>Videollamada</span>
                    </a>
                    <a href="{% url 'clinical:doctor_patient_record' appt.pk %}" class="action-btn record-btn" title="Historial">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                      </svg>
                      <span>Historial</span>
                    </a>
                    <a href="{% url 'scheduling:cancel_appointment' appt.pk %}" class="action-btn cancel-btn" title="Cancelar" onclick="return confirm('¿Está seguro que desea cancelar esta cita?');">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                      </svg>
                      <span>Cancelar</span>
                    </a>
                  </div>
                {% else %}
                  <span class="no-actions">-</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      <h3>No tienes citas asignadas</h3>
      <p>Cuando los pacientes agenden citas contigo, aparecerán aquí.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
