{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="/static/styles/scheduling/appointment_booking.css">

<div class="booking-container">
  <!-- Step Indicator -->
  <div class="step-indicator">
    <div class="step active">
      <div class="step-number">1</div>
      <div class="step-label">Seleccionar médico y fecha</div>
    </div>
    <div class="step-divider"></div>
    <div class="step">
      <div class="step-number">2</div>
      <div class="step-label">Confirmar horario</div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="booking-content">
    <div class="booking-header">
      <h2>Nueva cita - Paso 1</h2>
      <p>Selecciona el médico y la fecha para ver los horarios disponibles.</p>
    </div>

    <!-- Booking Form -->
    <div class="booking-form-card">
      <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
          <label for="{{ form.doctor.id_for_label }}" class="form-label">
            <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
            Médico
          </label>
          {{ form.doctor }}
        </div>

        <div class="form-group">
          <label for="{{ form.date.id_for_label }}" class="form-label">
            <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            Fecha
          </label>
          {{ form.date }}
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary">
            Buscar horarios
            <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
          <a href="{% url 'scheduling:patient_appointments' %}" class="btn-secondary">Volver a mis citas</a>
        </div>
      </form>
    </div>

    <!-- Doctors Availability -->
    {% if doctors_availability %}
    <div class="availability-section">
      <h3>Disponibilidad actual de los médicos</h3>
      <div class="doctors-grid">
        {% for item in doctors_availability %}
        <div class="doctor-availability-card">
          <div class="doctor-header">
            <div class="doctor-avatar">
              {{ item.doctor.get_full_name.0|upper }}
            </div>
            <div class="doctor-info">
              <h4>{{ item.doctor }}</h4>
              <span class="doctor-specialty">Médico general</span>
            </div>
          </div>
          
          <div class="availability-content">
            {% if item.days %}
              <div class="availability-list">
                {% for d in item.days %}
                <div class="availability-item">
                  <div class="availability-day">{{ d.day }}</div>
                  <div class="availability-slots">
                    {% for slot in d.slots %}
                      <span class="slot-badge">{{ slot }}</span>
                    {% endfor %}
                  </div>
                </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="empty-state-small">
                <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <p>Sin disponibilidad configurada</p>
              </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% else %}
    <div class="empty-state">
      <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <p>No hay médicos con disponibilidad configurada.</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
