{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'styles/dashboard/reports.css' %}">

<div class="reports-container">
  <div class="reports-header">
    <h1 class="reports-title">Reportes y descargas</h1>
    <p class="reports-subtitle">
      Visualiza y analiza los datos de citas. En futuras versiones podrás exportar reportes en PDF/Excel.
    </p>
  </div>

  <!-- Statistics Overview -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon stat-icon-total">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-label">Total de citas</div>
        <div class="stat-value">{{ appointments|length }}</div>
      </div>
    </div>

    <!-- Using appointments_by_status variable to dynamically display status metrics -->
    {% for label, count in appointments_by_status.items %}
    <div class="stat-card">
      <div class="stat-icon {% if label == 'Completada' %}stat-icon-completed{% elif label == 'Pendiente' or label == 'Programadas' %}stat-icon-pending{% elif label == 'Cancelada' %}stat-icon-cancelled{% else %}stat-icon-total{% endif %}">
        {% if label == 'Completada' %}
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        {% elif label == 'Pendiente' or label == 'Programadas' %}
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        {% elif label == 'Cancelada' %}
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        {% else %}
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        {% endif %}
      </div>
      <div class="stat-content">
        <div class="stat-label">{{ label }}</div>
        <div class="stat-value">{{ count }}</div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Export Section (Placeholder) -->
  <div class="export-section">
    <div class="export-header">
      <h2 class="export-title">Exportar datos</h2>
      <p class="export-description">Funcionalidad de exportación disponible próximamente</p>
    </div>
    <div class="export-buttons">
      <button class="export-btn export-btn-disabled" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="12" y1="18" x2="12" y2="12"></line>
          <line x1="9" y1="15" x2="15" y2="15"></line>
        </svg>
        Exportar PDF
      </button>
      <button class="export-btn export-btn-disabled" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        Exportar Excel
      </button>
    </div>
  </div>

  <!-- Data Table -->
  {% if appointments %}
    <div class="data-table-container">
      <div class="table-header">
        <h2 class="table-title">Registro de citas</h2>
        <div class="table-count">{{ appointments|length }} registros</div>
      </div>
      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th>Paciente</th>
              <th>Médico</th>
              <th>Fecha y hora</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            {% for appt in appointments %}
              <tr>
                <td>
                  <div class="table-user">
                    <div class="table-avatar">{{ appt.patient.first_name.0 }}{{ appt.patient.last_name.0 }}</div>
                    <span>{{ appt.patient }}</span>
                  </div>
                </td>
                <td>
                  <div class="table-user">
                    <div class="table-avatar table-avatar-doctor">{{ appt.doctor.first_name.0 }}{{ appt.doctor.last_name.0 }}</div>
                    <span>{{ appt.doctor }}</span>
                  </div>
                </td>
                <td>
                  <div class="table-datetime">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="16" y1="2" x2="16" y2="6"></line>
                      <line x1="8" y1="2" x2="8" y2="6"></line>
                      <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    {{ appt.scheduled_datetime|date:"d/m/Y H:i" }}
                  </div>
                </td>
                <td>
                  <span class="status-badge status-{{ appt.status }}">
                    {{ appt.get_status_display }}
                  </span>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      <h3>No hay citas para mostrar</h3>
      <p>Cuando se registren citas en el sistema, los datos aparecerán aquí.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
